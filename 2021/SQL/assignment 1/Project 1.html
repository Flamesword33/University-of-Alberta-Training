<!DOCTYPE html>
<html lang="en">
<head>
    <title>cmput391 Fall 2021 Project 1 - Davood Rafiei</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Davood Rafiei" />
    <meta name="description" content="Instructions: This assignment is meant to be completed individually or in pairs, under the Consultation model of collaboration as per the Computing Science Department Course Policies. You must not upload binary files or large text files of any kind as part of your submission." />
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                  Cmput 391 Fall 2021 Project 1
                </h1>
            </header>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2 id="instructions">Instructions:</h2>
<ul>
<li>This assignment is meant to be completed individually or in pairs, under the <strong>Consultation</strong> model of collaboration as per the Computing Science <a href="https://www.ualberta.ca/computing-science/links-and-resources/policy-information/department-course-policies">Department Course Policies</a>.</li>
<li>You must not upload <em>binary</em> files or large text files of any kind as part of your submission. </li>
<li> Your answers must be on the GitHub repository created by following the instructions on eClass.</li>
<li> That repository already has the folder structure for the assignment. DO NOT MODIFY that directory structure.</li>
<li> Submit the URL of your repository through eClass before the deadline.</li>
</ul>

<h1 id="learning-objectives">Learning Objectives</h1>
<p>This unit is intended for you to:</p>
<ol>
<li>Familiarize yourself with a modern cloud-based noSQL database system.</li>
<li>Review SQL and experiment with some of its non-relational extensions.</li>
</ol>
<h1 id="required-reading">Required Reading</h1>
<ul>
<li>From the <a href="https://docs.aws.amazon.com/athena/latest/ug/what-is.html">Amazon Athena documentation</a>, at least:<ul>
<li>What is Amazon Athena?</li>
<li>Getting Started</li>
<li>Accessing Amazon Athena</li>
<li>Creating Databases and Tables</li>
<li>Running Queries</li>
</ul>
</li>
<li>From the <a href="https://docs.aws.amazon.com/athena/latest/ug/ddl-sql-reference.html">SQL Reference for Amazon Athena</a><ul>
<li>Data Types in Athena</li>
<li>DML Queries, Functions, and Operators</li>
</ul>
</li>
<li>From the <a href="https://docs.aws.amazon.com/athena/latest/ug/querying-athena-tables.html">Running SQL Queries Using Amazon Athena</a><ul>
<li><a href="https://docs.aws.amazon.com/athena/latest/ug/flattening-arrays.html">The <code>UNNEST</code> operator</a></li>
</ul>
</li>
<li>All of the <a href="https://docs.aws.amazon.com/AmazonS3/latest/gsg/GetStartedWithS3.html">Amazon S3 documentation</a></li>
<li>The description of the <a href="https://www.imdb.com/interfaces/">IMDB dataset</a>.</li>
</ul>
<h1 id="tasks">Tasks</h1>
<h3 id="step-1-create-the-s3-buckets">Step 1: Create the S3 buckets</h3>
<p>Please note that you will deal with a small subset of the IMDB database.</p>
<ol>
<li>Following the instructions in the S3 documentation create a single bucket for the assignment with two main folders: one for the tables and another for the results.</li>
<li>Download the files from <a href="https://drive.google.com/drive/folders/1AsWDPUSoZLFhq86VbxSWzOXo53s49_94?usp=sharing">Google drive</a> into your computer.</li>
<li>Under the folder for the tables, create a separate folder for each of those files in the data folder of your S3 bucket.</li>
<li>Upload each file to its respective folder.</li>
</ol>
<p>Describe the steps you completed in your <code>README.md</code> file. Add screenshots to your <code>README.md</code> showing the results.</p>
<p><strong>NOTE:</strong> do not remove any file nor any table definition from your AWS account. The TAs will login to AWS and inspect your work to make sure it works correctly.</p>
<h3 id="step-2-create-the-tables-in-athena">Step 2: Create the tables in Athena</h3>
<p>Following the instructions in the Athena documentation:</p>
<ol>
<li>Create a database called <code>imdb</code>.</li>
<li>Add a table to the database for each of the files in the data folder.<ul>
<li>Name each table by ignoring the <code>.tsv.gz</code> extension and replacing the remaining period (<code>.</code>) by an underscore (<code>_</code>). For example, one of the tables will be called <code>name_basics</code>. </li>
<li>Name and define each attribute so that they match the description of the <a href="https://www.imdb.com/interfaces/">IMDB dataset</a> exactly.</li>
</ul>
</li>
</ol>
<p><strong>Notes:</strong></p>
<ul>
<li>The field separators are tabs (<code>\t</code>). </li>
<li>There are inconsistencies in the way the data was released by IMDB itself and those inconsistencies were left in the data provided to you.</li>
<li>Athena's <a href="https://docs.aws.amazon.com/athena/latest/ug/serde-about.html">SERDE</a> (SERializer/DEserializer) on CSV and TSV files does not recognize non-relational fields with lists of values. Instead, you should set up your tables in a way that those fields are recognized as strings.</li>
</ul>
<p>Describe the steps you completed in your <code>README.md</code> file. Add screenshots to your <code>README.md</code> showing the results. Make sure to explain how you handled non-relational attributes in the data.</p>
<h2 id="queries">Queries</h2>
<p>Write queries in Athena to answer the questions below. Add your query and a file with the answer to the corresponding folder in the Github repository. </p>
<h4 id="025-marks-each">0.25 marks each</h4>
<p><strong>Q1</strong> -- Find all titles acted by George Clooney with an average rating larger than 7.5.
<p><strong>Q2</strong> -- Who is playing "Jeremy" in Payback? Jeremy refers to the primary title and we want to return the name of the person.
<p><strong>Q3</strong> -- Find all titles in which Jack Nicholson is the first actor (i.e. ordering is 1).
<h4 id="05-marks-each">0.5 marks each</h4>
<p><strong>Q4</strong> -- Find people who have the first role in action movies in which Morgan Freeman has acted. Return the names of qualifying people.
<p><strong>Q5</strong> -- Find the number of movie titles that have more writers than actors and actresses combined.
<p><strong>Q6</strong> -- Find top 5 not-null character names in Action movies.
<p><strong>Q7</strong> -- Find the genre of all titles acted by Robin Williams. There should be one genre per row with no duplicates.
<p><strong>Q8</strong> -- Find top 5 titles with the highest ratings where each rating is computed as the product of average rating and the number of votes.
<h4 id="075-marks-each">0.75 marks each</h4>
<p><strong>Q9</strong> -- For each of 1, 2, 3 and 4, find the number of people who are known for that many titles. The result will have 4 rows.
<h4 id="1-mark-each">1 mark each</h4>
<p><strong>Q10</strong> -- For each of 1, 2, 3 and 4, find the fraction of people who are known for that many titles. Show each fraction using 4 digits of decimal.

<h1 id="grading">Grading</h1>
<p> Your queries will be executed on Amazon Athena, and
each query will be scored based on correctness, clarity, and documentation with 80% of the mark allocated for the correctness and 20% of the mark for clarity and documentation. If the correctness mark is zero, the mark for the query is zero independent of its clarity and documentation.</p>

<p> <b>For a full mark in correctness</b>, the query must compute exactly the expected answer, with all columns and all rows as expected and all values are computed as required. The query does not perform any unnecessary steps and all data manipulation expressions and operations are appropriate. The query is generic and computes the correct answer on any legal instance of the schema. <b>Up to 20% deduction</b> if the query returns unnecessary columns OR some of the data manipulations are inappropriate or unnecessary. 
<b>50% or more deduction</b> if the query returns a subset or a superset of the expected answer set. <b>0 mark</b> if the query does not run, OR the query does not correctly compute any logical steps needed for a correct solution.</p>

<p> <b>For a full mark in clarity and documentation</b>, it is expected that (1) the query is formatted and indented properly; (2) all necessary sub-queries are declared in CTEs if it helps with the readability; (3) all tuple variables have readable and sensible names; (4) the query has appropriate comments; (5) the README file explains the intuition behind each step in the query.

<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Davood Rafiei
         <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>, except where indicated otherwise. 
</small></p>
  <p> <small>The project template by Denilson Barbosa at <a href="https://www.ualberta.ca/~denilson/cmput391-winter-2021-homework-1.html">https://www.ualberta.ca/~denilson/cmput391-winter-2021-homework-1.html</a>.
</footer>
